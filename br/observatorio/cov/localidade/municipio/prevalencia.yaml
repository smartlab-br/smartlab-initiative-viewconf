# ========================================================
principais:
  - relevance: 'lead' 
    cls: 'xs12 xl6'
    rowClass: "pt-0 px-3 pb-5"
    api: 
      template: "/thematic/casoscovid19?categorias=city_ibge_code,last_available_date,last_available_confirmed&filtros=eq-city_ibge_code-{0},and,eq-place_type-'city',and,eq-is_last-TRUE"
      args:
        - named_prop: "idLocalidadeD6"
    args:
      - prop: "value"
        named_prop: 'last_available_confirmed'
        format: 'inteiro'
        default: 'Nenhum'
        zero: 'Nenhum'
      - prop: "description"
        fixed: "Casos Confirmados"
      - prop: 'comment'
        named_prop: 'last_available_date'
        format: 'dataDMY'
    # chart:
    #   id: "line_te_rgt"
    #   type: "LINE"
    #   api: 
    #     template: "/te/indicadoresmunicipais?categorias=cd_indicador,nu_competencia,vl_indicador&filtros=eq-cd_mun_ibge_dv-{0},and,eq-cd_indicador-'te_rgt'"
    #     args:
    #       - named_prop: "idLocalidade"
    #     options:
    #       formatters:
    #         - id: "vl_indicador"
    #           format: 'inteiro'
    #   headers:
    #     - text: 'Ano'
    #       align: 'left'
    #       value: 'nu_competencia'
    #     - text: 'Nº resgatados do trabalho escravo'
    #       value: 'fmt_vl_indicador'
    #   options:
    #     id: 'cd_indicador'
    #     x: 'nu_competencia'
    #     y: "vl_indicador"
    #     x_options:
    #       axis: false
    #     y_options:
    #       axis: false
    #     hide_legend: true
    #     color: "#00C853"
  - relevance: 'lead' 
    cls: 'xs12 xl6'
    rowClass: "pt-0 px-3 pb-5"
    api: 
      template: "/thematic/casoscovid19?categorias=city_ibge_code,last_available_date,last_available_deaths&filtros=eq-city_ibge_code-{0},and,eq-place_type-'city',and,eq-is_last-TRUE"
      args:
        - named_prop: "idLocalidadeD6"
    args:
      - prop: "value"
        named_prop: 'last_available_deaths'
        format: 'inteiro'
        default: 'Nenhum'
        zero: 'Nenhum'
      - prop: "description"
        fixed: "Óbitos Confirmados"
      - prop: 'comment'
        named_prop: 'last_available_date'
        format: 'dataDMY'
  - relevance: 'lead' 
    cls: 'xs12 xl6'
    rowClass: "pt-0 px-3 pb-5"
    api: 
      template: "/thematic/casoscovid19?categorias=city_ibge_code,last_available_date,last_available_confirmed,last_available_deaths&filtros=eq-city_ibge_code-{0},and,eq-place_type-'city',and,eq-is_last-TRUE"
      args:
        - named_prop: "idLocalidadeD6"
    args:
      - prop: "value"
        function: 'calc_percentage'
        format: 'porcentagem'
        fn_args:
          - named_prop: "last_available_deaths"
          - named_prop: "last_available_confirmed"
      - prop: "description"
        fixed: "Letalidade"
      - prop: 'comment'
        named_prop: 'date_info'
        format: 'dataDMY'
  - relevance: 'lead' 
    cls: 'xs12 xl6'
    rowClass: "pt-0 px-3 pb-5"
    api: 
      template: "/thematic/casoscovid19?categorias=last_available_date,last_available_confirmed_per_100k_inhabitants&filtros=eq-place_type-'city',and,eq-is_last-TRUE,and,eq-cd_municipio_ibge_dv-{0}"
      args:
        - named_prop: 'idLocalidade'
    args:
      - prop: "value"
        named_prop: 'last_available_confirmed_per_100k_inhabitants'
        format: 'real'
        precision: 2
        default: "Sem Registros"
        zero: "Nenhum"
      - prop: "description"
        fixed: 'Casos confirmados'
      - prop: "comment"
        fixed: 'por 100.000 hab.'
  - relevance: 'lead' 
    cls: 'xs12 xl6'
    rowClass: "pt-0 px-3 pb-5"
    api: 
      template: "/thematic/casoscovid19?categorias=last_available_date,last_available_death_per_100k_inhabitants&filtros=eq-place_type-'city',and,eq-is_last-TRUE,and,eq-cd_municipio_ibge_dv-{0}"
      args:
        - named_prop: 'idLocalidade'
    args:
      - prop: "value"
        named_prop: 'last_available_death_per_100k_inhabitants'
        format: 'real'
        precision: 2
        default: "Sem Registros"
        zero: "Nenhum"
      - prop: "description"
        fixed: 'Óbitos confirmados'
      - prop: "comment"
        fixed: 'por 100.000 hab.'
# ========================================================
secoes:
  - id: 'prevalencia_main_story'
    name: "Contexto Geográfico"
    cards:
# ========================================================
      - id: "mapa_casos"
        title: 
          fixed: "Distribuição Geográfica"
        title_comment:
          template: "{0}, {1}"
          api: 
            template: "/thematic/casoscovid19?categorias=last_available_date&filtros=eq-place_type-'city',and,eq-is_last-TRUE,and,eq-cd_municipio_ibge_dv-{0}"
            args:
              - named_prop: 'idLocalidade'
          args:
            - base_object: "localidade"
              named_prop: "nm_localidade"
            - named_prop: "last_available_date"
              format: 'dataDMY'
        # info:
        #   - type: "text"
        #     title: "Sobre a métrica"
        #     content:
        #       fixed: ""
        description:
          - type: "minicards"
            cards:
              - relevance: 'high'
                cls: 'xs12 md6'
                api: 
                  template: "/thematic/casoscovid19?categorias=last_available_date,last_available_confirmed&filtros=eq-place_type-'city',and,eq-is_last-TRUE,and,eq-cd_municipio_ibge_dv-{0}"
                  args:
                    - named_prop: 'idLocalidade'
                args:
                  - prop: "value"
                    named_prop: 'last_available_confirmed'
                    format: 'inteiro'
                    default: "Sem Registros"
                    zero: "Nenhum"
                  - prop: "description"
                    fixed: 'Casos confirmados'
              - relevance: 'high'
                cls: 'xs12 md6'
                api: 
                  template: "/thematic/casoscovid19?categorias=last_available_date,last_available_deaths&filtros=eq-place_type-'city',and,eq-is_last-TRUE,and,eq-cd_municipio_ibge_dv-{0}"
                  args:
                    - named_prop: 'idLocalidade'
                args:
                  - prop: "value"
                    named_prop: 'last_available_deaths'
                    format: 'inteiro'
                    default: "Sem Registros"
                    zero: "Nenhum"
                  - prop: "description"
                    fixed: 'Óbitos confirmados'
              - relevance: 'low'
                cls: 'xs12 md6'
                api: 
                  template: "/thematic/casoscovid19?categorias=last_available_date,last_available_confirmed_per_100k_inhabitants&filtros=eq-place_type-'city',and,eq-is_last-TRUE,and,eq-cd_municipio_ibge_dv-{0}"
                  args:
                    - named_prop: 'idLocalidade'
                args:
                  - prop: "value"
                    named_prop: 'last_available_confirmed_per_100k_inhabitants'
                    format: 'real'
                    precision: 2
                    default: "Sem Registros"
                    zero: "Nenhum"
                  - prop: "description"
                    fixed: 'Casos confirmados'
                  - prop: "comment"
                    fixed: 'por 100.000 hab.'
              - relevance: 'low'
                cls: 'xs12 md6'
                api: 
                  template: "/thematic/casoscovid19?categorias=last_available_date,last_available_death_per_100k_inhabitants&filtros=eq-place_type-'city',and,eq-is_last-TRUE,and,eq-cd_municipio_ibge_dv-{0}"
                  args:
                    - named_prop: 'idLocalidade'
                args:
                  - prop: "value"
                    named_prop: 'last_available_death_per_100k_inhabitants'
                    format: 'real'
                    precision: 2
                    default: "Sem Registros"
                    zero: "Nenhum"
                  - prop: "description"
                    fixed: 'Óbitos confirmados'
                  - prop: "comment"
                    fixed: 'por 100.000 hab.'
              - relevance: 'low'
                cls: 'xs12 md6'
                api: 
                  template: "/thematic/casoscovid19?categorias=last_available_date,last_available_death_rate&filtros=eq-place_type-'city',and,eq-is_last-TRUE,and,eq-cd_municipio_ibge_dv-{0}"
                  args:
                    - named_prop: 'idLocalidade'
                args:
                  - prop: "value"
                    named_prop: 'last_available_death_rate'
                    format: 'porcentagem'
                    multiplier: 100
                    default: "Sem Registros"
                    zero: "Nenhum"
                  - prop: "description"
                    fixed: 'Letalidade'
          - type: "text"
            title: ""
            content:
              fixed: "Em destaque, o número de casos e óbitos confirmados (total e por 100.000 habitantes) de COVID-19 e a taxa de letalidade no município selecionado.
              No mapa, apresenta-se a perspectiva comparativa entre os diferentes municípios da unidade federativa, com escala de cores que varia do claro (menor) para o escuro (maior), para a opção selecionada abaixo:<br/>"
          - id: "covid_valor"
            type: "radio"
            items:
              - id: "casos"
                value: "last_available_confirmed"
                default: true
                color: "light-blue"
                label: "CASOS CONFIRMADOS"
              - id: "obitos"
                value: "last_available_deaths"
                color: "red"
                label: "ÓBITOS CONFIRMADOS"
              - id: "letalidade"
                value: "last_available_death_rate"
                color: "orange"
                label: "LETALIDADE"
              - id: "casos100M"
                value: "last_available_confirmed_per_100k_inhabitants"
                color: "green accent-4"
                label: "CASOS CONFIRMADOS/100.000 hab."
              - id: "obitos100M"
                value: "last_available_death_per_100k_inhabitants"
                color: "purple"
                label: "ÓBITOS CONFIRMADOS/100.000 hab."
            selection:
              event: 'selection'
              rules:
                api:
                  template: "/thematic/casoscovid19?categorias={0}-valor,estimated_population_2019,cd_municipio_ibge_dv,city,last_available_date,last_available_confirmed,last_available_deaths,last_available_confirmed_per_100k_inhabitants,last_available_death_per_100k_inhabitants,last_available_death_rate&filtros=eq-place_type-'city',and,eq-is_last-TRUE,and,eq-cd_uf-{1},and,ne-{0}-0"
                  args:
                    - named_prop: "covid_valor"
                    - named_prop: 'cd_uf'
        chart_type: "MAP_TOPOJSON"
        api: 
          template: "/thematic/casoscovid19?categorias=last_available_confirmed-valor,estimated_population_2019,cd_municipio_ibge_dv,city,last_available_date,last_available_confirmed,last_available_deaths,last_available_confirmed_per_100k_inhabitants,last_available_death_per_100k_inhabitants,last_available_death_rate&filtros=eq-place_type-'city',and,eq-is_last-TRUE,and,eq-cd_uf-{0},and,ne-last_available_confirmed-0"
          args:
            - named_prop: 'cd_uf'
          options:
            calcs:
              - id: "deviation_valor"
                function: "get_log"
                fn_args:
                  - fixed: "valor"
            formatters:
              - id: "estimated_population_2019"
                format: 'inteiro'
              - id: "last_available_deaths"
                format: 'inteiro'
              - id: "last_available_confirmed"
                format: 'inteiro'
              - id: "last_available_death_rate"
                format: 'porcentagem'
                multiplier: 100
              - id: "last_available_confirmed_per_100k_inhabitants"
                format: 'real'
                precision: 2
              - id: "last_available_death_per_100k_inhabitants"
                format: 'real'
                precision: 2
              - id: "last_available_date"
                format: 'dataDMY'
        headers:
          - text: 'Município'
            align: 'left'
            value: 'city'
          - text: 'População estimada (2019)'
            value: 'fmt_estimated_population_2019'
          - text: 'Casos confirmados'
            value: 'fmt_last_available_confirmed'
          - text: 'Óbitos confirmados'
            value: 'fmt_last_available_deaths'
          - text: 'Letalidade'
            value: 'fmt_last_available_death_rate'
          - text: 'Casos confirmados/100.000 hab.'
            value: 'fmt_last_available_confirmed_per_100k_inhabitants'
          - text: 'Óbitos confirmados/100.000 hab.'
            value: 'fmt_last_available_death_per_100k_inhabitants'
          - text: 'Data coleta'
            value: 'fmt_last_available_date'
        chart_options:
          id_field: 'cd_municipio_ibge_dv'
          topo_key: "codarea"
          value_field: 'calc_deviation_valor'
          colorScale: 
            type: "singleHue"
            scale_name_value: "covid_valor"
            color_array: 
              "last_available_confirmed": "Blues"
              "last_available_deaths": "Reds"
              "last_available_death_rate": "Oranges"
              "last_available_confirmed_per_100k_inhabitants": "Greens"
              "last_available_death_per_100k_inhabitants": "Purples"
        source:
          desc: "Brasil.io"
          link: "https://brasil.io/covid19/"
# ========================================================
      - id: "mapa_casos_regic"
        title: 
          fixed: "Distribuição Geográfica por Pólo de Atendimento de Alta Complexidade"
        title_comment:
          template: "{0}, {1}"
          api: 
            template: "/thematic/arranjoregic?categorias=dt_coleta_covid_arranjo&filtros=eq-cd_municipio_ibge_origem-{0}"
            args:
              - named_prop: "idLocalidadeD6"
          args:
            - base_object: "localidade"
              named_prop: "nm_localidade"
            - named_prop: "dt_coleta_covid_arranjo"
              format: "dataDMY"
        # info:
        #   - type: "text"
        #     title: "Sobre a métrica"
        #     content:
        #       fixed: ""
        description:
          - type: "minicards"
            cards:
              - relevance: 'high'
                cls: 'xs12'
                api: 
                  template: "/thematic/arranjoregic?categorias=nm_municipio_uf_alta_complex&filtros=eq-cd_municipio_ibge_origem-{0}"
                  args:
                    - named_prop: "idLocalidadeD6"
                args:
                  - prop: "value"
                    template: "Arranjo Populacional<br/>{0}"
                    args:
                      - named_prop: 'nm_municipio_uf_alta_complex'
                        default: "Sem Registros"
                  - prop: "description"
                    fixed: 'Destino para atendimento de alta complexidade'
              - relevance: 'high'
                cls: 'xs12 md6'
                api: 
                  template: "/thematic/arranjoregic?categorias=qt_casos_covid_arranjo&filtros=eq-cd_municipio_ibge_origem-{0}"
                  args:
                    - named_prop: "idLocalidadeD6"
                args:
                  - prop: "value"
                    named_prop: 'qt_casos_covid_arranjo'
                    format: 'inteiro'
                    default: "Sem Registros"
                    zero: "Nenhum"
                  - prop: "description"
                    fixed: 'Casos confirmados'
              - relevance: 'high'
                cls: 'xs12 md6'
                api: 
                  template: "/thematic/arranjoregic?categorias=qt_mortes_covid_arranjo&filtros=eq-cd_municipio_ibge_origem-{0}"
                  args:
                    - named_prop: "idLocalidadeD6"
                args:
                  - prop: "value"
                    named_prop: 'qt_mortes_covid_arranjo'
                    format: 'inteiro'
                    default: "Sem Registros"
                    zero: "Nenhum"
                  - prop: "description"
                    fixed: "Óbitos confirmados"
              - relevance: 'low'
                cls: 'xs12 md6'
                api: 
                  template: "/thematic/arranjoregic?categorias=qt_municipios_arranjo&filtros=eq-cd_municipio_ibge_origem-{0}"
                  args:
                    - named_prop: "idLocalidadeD6"
                args:
                  - prop: "value"
                    named_prop: 'qt_municipios_arranjo'
                    format: 'inteiro'
                    default: "Sem Registros"
                    zero: "Nenhum"
                  - prop: "description"
                    fixed: 'Municípios atendidos'
              - relevance: 'low'
                cls: 'xs12 md6'
                api: 
                  template: "/thematic/arranjoregic?categorias=populacao_arranjo&filtros=eq-cd_municipio_ibge_origem-{0}"
                  args:
                    - named_prop: "idLocalidadeD6"
                args:
                  - prop: "value"
                    named_prop: 'populacao_arranjo'
                    format: 'inteiro'
                    collapse:
                      format: 'real'
                    default: "Sem Registros"
                    zero: "Nenhum"
                  - prop: "description"
                    fixed: 'População atendida'
              - relevance: 'low'
                cls: 'xs12 md6'
                api: 
                  template: "/thematic/arranjoregic?categorias=proporcao_mortes_covid_arranjo&filtros=eq-cd_municipio_ibge_origem-{0}"
                  args:
                    - named_prop: "idLocalidadeD6"
                args:
                  - prop: "value"
                    named_prop: 'proporcao_mortes_covid_arranjo'
                    format: 'porcentagem'
                    multiplier: 100
                    default: "Sem Registros"
                    zero: "Nenhum"
                  - prop: "description"
                    fixed: 'Letalidade'
          - type: "text"
            title: ""
            content:
              fixed: "Em destaque, o número total de casos e óbitos confirmados por COVID-19 e a taxa de letalidade no arranjo populacional do pólo de atendimento de saúde de alta complexidade que atende o município selecionado, assim como o número de municípios e da população atendida pelo pólo.
              No mapa, apresenta-se a perspectiva comparativa entre os arranjos populacionais dos pólos de atendimento de saúde de alta complexidade, com escala de cores que varia do claro (menor) para o escuro (maior), para a opção selecionada abaixo:<br/>"
          - id: "covid_valor"
            type: "radio"
            items:
              - id: "casos"
                value: "qt_casos_covid_arranjo"
                default: true
                color: "light-blue"
                label: "CASOS CONFIRMADOS"
              - id: "obitos"
                value: "qt_mortes_covid_arranjo"
                color: "red"
                label: "ÓBITOS CONFIRMADOS"
              - id: "letalidade"
                value: "proporcao_mortes_covid_arranjo"
                color: "orange"
                label: "LETALIDADE"
            selection:
              event: 'selection'
              rules:
                api:
                  template: "/thematic/arranjoregic?categorias=latitude_alta_complex-lat,longitude_alta_complex-long,{0}-valor,populacao_arranjo,qt_municipios_arranjo,dt_coleta_covid_arranjo,qt_casos_covid_arranjo,qt_mortes_covid_arranjo,nm_municipio_uf_alta_complex-target_mun,cd_municipio_ibge_alta_complex-target_cd_mun,cd_municipio_ibge_dv_alta_complex-cd_mun_ibge&agregacao=DISTINCT&filtros=eq-cd_uf_origem-{1},and,nn-cd_municipio_ibge_dv_alta_complex"
                  args:
                    - named_prop: "covid_valor"
                    - named_prop: 'cd_uf'
        chart_type: "MAP_POLYGON"
        api: 
          template: "/thematic/arranjoregic?categorias=latitude_alta_complex-lat,longitude_alta_complex-long,qt_casos_covid_arranjo-valor,populacao_arranjo,qt_municipios_arranjo,dt_coleta_covid_arranjo,qt_casos_covid_arranjo,qt_mortes_covid_arranjo,proporcao_mortes_covid_arranjo,populacao_aglomerados_subnormais_arranjo,nm_municipio_uf_alta_complex-target_mun,cd_municipio_ibge_alta_complex-target_cd_mun,cd_municipio_ibge_dv_alta_complex-cd_mun_ibge&agregacao=DISTINCT&filtros=eq-cd_uf_origem-{0},and,nn-cd_municipio_ibge_dv_alta_complex"
          args:
            - named_prop: "cd_uf"
          options:
            calcs:
              - id: "deviation_valor"
                function: "get_log"
                fn_args:
                  - fixed: "valor"
            formatters:
              - id: "populacao_arranjo"
                format: "inteiro"
              - id: "populacao_arranjo"
                format: "inteiro"
              - id: "populacao_aglomerados_subnormais_arranjo"
                format: "inteiro"
              - id: "qt_casos_covid_arranjo"
                format: "inteiro"
              - id: "qt_mortes_covid_arranjo"
                format: "inteiro"
              - id: "proporcao_mortes_covid_arranjo"
                format: "porcentagem"
                multiplier: 100
              - id: "dt_coleta_covid_arranjo"
                format: "dataDMY"
        headers:
          - text: 'Arranjo Populacional'
            align: 'left'
            value: 'target_mun'
          - text: 'Municípios atendidos'
            value: 'qt_municipios_arranjo'
          - text: 'População atendida'
            value: 'fmt_populacao_arranjo'
          - text: 'População aglomerados subnormais (2010)'
            value: 'fmt_populacao_aglomerados_subnormais_arranjo'
          - text: 'COVID-19 - Data coleta'
            value: 'fmt_dt_coleta_covid_arranjo'
          - text: 'COVID-19 - Casos confirmados'
            value: 'fmt_qt_casos_covid_arranjo'
          - text: 'COVID-19 - Óbitos confirmados'
            value: 'fmt_qt_mortes_covid_arranjo'
          - text: 'COVID-19 - Letalidade'
            value: 'fmt_proporcao_mortes_covid_arranjo'
        chart_options:
          height_proportion: 1.77
          id_field: 'cd_mun_ibge'
          topo_key: "CodReg"
          value_field: 'calc_deviation_valor'
          tooltip_function: 'obsCovidRegicTooltip'
          lat: "lat"
          long: "long"
          show_legend: true
          topology:
            scope: "regic"
            range: "uf"
          colorScale: 
            type: "singleHue"
            scale_name_value: "covid_valor"
            color_array: 
              "qt_casos_covid_arranjo": "Blues"
              "qt_mortes_covid_arranjo": "Reds"
              "proporcao_mortes_covid_arranjo": "Oranges"
        source:
          desc: "IBGE - Regiões de Influência das Cidades - REGIC, Brasil.io e CNES - Cadastro Nacional de Estabelecimentos de Saúde"
          # link: "https://brasil.io/covid19/"
# # ========================================================
#       - id: "mapa_prev_brasil"
#         chart_type: "MAP_BUBBLES"
#         title: 
#           fixed: "Distribuição Geográfica"
#         title_comment:
#           template: "{0}, {1}"
#           api: 
#             template: "/thematic/casoscovid19?categorias=last_available_date&filtros=eq-place_type-'city',and,eq-is_last-TRUE,and,eq-cd_municipio_ibge_dv-{0}"
#             args:
#               - named_prop: 'idLocalidade'
#           args:
#             - base_object: "localidade"
#               named_prop: "nm_localidade"
#             - named_prop: "last_available_date"
#               format: 'dataDMY'
#         # info:
#         #   - type: "text"
#         #     title: "Sobre"
#         #     content:
#         #       fixed: ""
#          description:
#           - type: "text"
#             title: ""
#             content:
#               fixed: "Texto..."
#           - id: "selectlayer"
#             type: "switch-group"
#             switches:
#               - id: "casos"
#                 default: true
#                 color: "light-blue"
#                 label: "CASOS CONFIRMADOS"
#               - id: "obitos"
#                 default: true
#                 color: "red"
#                 label: "ÓBITOS CONFIRMADOS"
#               - id: "conf100M"
#                 default: false
#                 color: "green accent-4"
#                 label: "CASOS CONFIRMADOS/100.000 hab."
#               - id: "obitos100M"
#                 default: false
#                 color: "purple"
#                 label: "ÓBITOS CONFIRMADOS/100.000 hab."
#             event: 'selection'
#         api:
#         # &calcs=ln_norm_pos_part&partition=cd_municipio_ibge_dv
#           - template: "/thematic/casoscovid19?categorias=cd_municipio_ibge_dv-cd_mun_ibge,nm_municipio_uf,'casos'-codigo,last_available_date,last_available_deaths,last_available_confirmed_per_100k_inhabitants,last_available_death_rate,last_available_confirmed-valor,latitude,longitude&valor=last_available_confirmed&calcs=ln_norm_pos_part&partition=is_last&filtros=eq-place_type-'city',and,eq-is_last-TRUE,and,ne-latitude-0,and,ne-longitude-0,and,eq-cd_uf-{0}"
#             args:
#               - named_prop: 'cd_uf'
#           - template: "/thematic/casoscovid19?categorias=cd_municipio_ibge_dv-cd_mun_ibge,nm_municipio_uf,'obitos'-codigo,last_available_date,last_available_confirmed,last_available_confirmed_per_100k_inhabitants,last_available_death_rate,last_available_deaths-valor,latitude,longitude&valor=last_available_deaths&calcs=ln_norm_pos_part&partition=is_last&filtros=eq-place_type-'city',and,eq-is_last-TRUE,and,ne-latitude-0,and,ne-longitude-0,and,eq-cd_uf-{0}"
#             args:
#               - named_prop: 'cd_uf'
#           - template: "/thematic/casoscovid19?categorias=cd_municipio_ibge_dv-cd_mun_ibge,nm_municipio_uf,'conf100M'-codigo,last_available_date,last_available_confirmed,last_available_deaths,last_available_death_rate,last_available_confirmed_per_100k_inhabitants-valor,latitude,longitude&valor=last_available_confirmed_per_100k_inhabitants&calcs=ln_norm_pos_part&partition=is_last&filtros=eq-place_type-'city',and,eq-is_last-TRUE,and,ne-latitude-0,and,ne-longitude-0,and,eq-cd_uf-{0}"
#             args:
#               - named_prop: 'cd_uf'
#           - template: "/thematic/casoscovid19?categorias=cd_municipio_ibge_dv-cd_mun_ibge,nm_municipio_uf,'obitos100M'-codigo,last_available_date,last_available_confirmed,last_available_deaths,last_available_confirmed_per_100k_inhabitants,last_available_death_rate-valor,latitude,longitude&valor=last_available_death_rate&calcs=ln_norm_pos_part&partition=is_last&filtros=eq-place_type-'city',and,eq-is_last-TRUE,and,ne-latitude-0,and,ne-longitude-0,and,eq-cd_uf-{0}"
#             args:
#               - named_prop: 'cd_uf'
#         chart_options:
#           colorArray: ["rgba(179, 9, 0, 0.7)", "rgba(21, 101, 192, 0.7)", "rgba(25, 125, 25, 0.7)", "#9C27B0"]
#           indicadores: ["obitos","casos","conf100M", "obitos100M"]
#           lat: 'latitude'
#           long: 'longitude'
#           id_field: 'codigo' 
#           clickable: true
#           radius:
#             base: 2500
#             multiplier: 800000
#           tiles_url: "https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}"
#           tiles_attribution: "Tiles &copy; Esri &mdash; Source: Esri, DeLorme, NAVTEQ, USGS, Intermap, iPC, NRCAN, Esri Japan, METI, Esri China (Hong Kong), Esri (Thailand), TomTom, 2012"
#         headers:
#           - text: 'Município'
#             value: 'nm_municipio_uf'
#           - text: 'Casos confirmados'
#             value: 'last_available_confirmed'
#             format: 'inteiro'
#           - text: 'Óbitos confirmados'
#             value: 'last_available_deaths'
#             format: 'inteiro'
#           - text: 'Casos confirmados/100.000 hab.'
#             value: 'last_available_confirmed_per_100k_inhabitants'
#             format: 'real'
#             precision: 2
#           - text: 'Óbitos confirmados/100.000 hab.'
#             value: 'last_available_death_rate'
#             format: 'real'
#             precision: 2
#           - text: 'Data coleta'
#             value: 'last_available_date'
#              format: 'dataDMY'
#         source:
#           desc: "Brasil.io"
#           link: "https://brasil.io/covid19/"
# ========================================================
      - id: "mapa_prev_brasil_calor"
        chart_type: "MAP_HEAT"
        title: 
          fixed: "Mapa de Calor"
        title_comment:
          template: "{0}, {1}"
          api: 
            template: "/thematic/casoscovid19?categorias=last_available_date&filtros=eq-place_type-'city',and,eq-is_last-TRUE,and,eq-cd_municipio_ibge_dv-{0}"
            args:
              - named_prop: 'idLocalidade'
          args:
            - base_object: "localidade"
              named_prop: "nm_localidade"
            - named_prop: "last_available_date"
              format: 'dataDMY'
        # info:
        #   - type: "text"
        #     title: "Sobre"
        #     content:
        #       fixed: ""
        description:
          - type: "minicards"
            cards:
              - relevance: 'high'
                cls: 'xs12 md6'
                api: 
                  template: "/thematic/casoscovid19?categorias=last_available_date,last_available_confirmed&filtros=eq-place_type-'city',and,eq-is_last-TRUE,and,eq-cd_municipio_ibge_dv-{0}"
                  args:
                    - named_prop: 'idLocalidade'
                args:
                  - prop: "value"
                    named_prop: 'last_available_confirmed'
                    format: 'inteiro'
                    default: "Sem Registros"
                    zero: "Nenhum"
                  - prop: "description"
                    fixed: 'Casos confirmados'
              - relevance: 'high'
                cls: 'xs12 md6'
                api: 
                  template: "/thematic/casoscovid19?categorias=last_available_date,last_available_deaths&filtros=eq-place_type-'city',and,eq-is_last-TRUE,and,eq-cd_municipio_ibge_dv-{0}"
                  args:
                    - named_prop: 'idLocalidade'
                args:
                  - prop: "value"
                    named_prop: 'last_available_deaths'
                    format: 'inteiro'
                    default: "Sem Registros"
                    zero: "Nenhum"
                  - prop: "description"
                    fixed: 'Óbitos confirmados'
              - relevance: 'low'
                cls: 'xs12 md6'
                api: 
                  template: "/thematic/casoscovid19?categorias=last_available_date,last_available_confirmed_per_100k_inhabitants&filtros=eq-place_type-'city',and,eq-is_last-TRUE,and,eq-cd_municipio_ibge_dv-{0}"
                  args:
                    - named_prop: 'idLocalidade'
                args:
                  - prop: "value"
                    named_prop: 'last_available_confirmed_per_100k_inhabitants'
                    format: 'real'
                    precision: 2
                    default: "Sem Registros"
                    zero: "Nenhum"
                  - prop: "description"
                    fixed: 'Casos confirmados'
                  - prop: "comment"
                    fixed: 'por 100.000 hab.'
              - relevance: 'low'
                cls: 'xs12 md6'
                api: 
                  template: "/thematic/casoscovid19?categorias=last_available_date,last_available_death_per_100k_inhabitants&filtros=eq-place_type-'city',and,eq-is_last-TRUE,and,eq-cd_municipio_ibge_dv-{0}"
                  args:
                    - named_prop: 'idLocalidade'
                args:
                  - prop: "value"
                    named_prop: 'last_available_death_per_100k_inhabitants'
                    format: 'real'
                    precision: 2
                    default: "Sem Registros"
                    zero: "Nenhum"
                  - prop: "description"
                    fixed: 'Óbitos confirmados'
                  - prop: "comment"
                    fixed: 'por 100.000 hab.'
              - relevance: 'low'
                cls: 'xs12 md6'
                api: 
                  template: "/thematic/casoscovid19?categorias=last_available_date,last_available_death_rate&filtros=eq-place_type-'city',and,eq-is_last-TRUE,and,eq-cd_municipio_ibge_dv-{0}"
                  args:
                    - named_prop: 'idLocalidade'
                args:
                  - prop: "value"
                    named_prop: 'last_available_death_rate'
                    format: 'porcentagem'
                    multiplier: 100
                    default: "Sem Registros"
                    zero: "Nenhum"
                  - prop: "description"
                    fixed: 'Letalidade'
          - type: "text"
            title: ""
            content:
              fixed: "Em destaque, o número de casos e óbitos confirmados (total e por 100.000 habitantes) de COVID-19 e a taxa de letalidade no município selecionado.
              O mapa de calor representa, conforme suas cores, medidas da intensidade da ocorrência de casos ou óbitos confirmados de COVID-19 na unidade federativa. 
              A variação de cores frias para cores quentes (de forma crescente) indica locais de maior ocorrência da opção selecionada abaixo:<br/>"
          - id: "selectlayer"
            type: "radio"
            items:
              - id: "casos"
                cls: "xs12"
                label: "Casos confirmados"
                color: "light-blue"
                value: "casos"
                default: true
              - id: "obitos"
                cls: "xs12"
                label: "Óbitos confirmados"
                color: "red"
                value: "obitos"
            event: 'selection'
        api:
          - template: "/thematic/casoscovid19?categorias=cd_municipio_ibge_dv,nm_municipio_uf,'casos'-cd_indicador,last_available_date,last_available_deaths,last_available_confirmed_per_100k_inhabitants,last_available_death_rate,estimated_population_2019,last_available_confirmed-vl_indicador,latitude,longitude&valor=last_available_confirmed&calcs=ln_norm_pos_part&partition=is_last&filtros=eq-place_type-'city',and,eq-is_last-TRUE,and,ne-latitude-0,and,ne-longitude-0,and,eq-cd_uf-{0}"
            args:
              - named_prop: 'cd_uf'
            options:
              formatters:
                - id: "estimated_population_2019"
                  format: 'inteiro'
                - id: "vl_indicador"
                  format: 'inteiro'
                - id: "last_available_deaths"
                  format: 'inteiro'
                - id: "last_available_confirmed"
                  format: 'inteiro'
                - id: "last_available_confirmed_per_100k_inhabitants"
                  format: 'real'
                  precision: 2
                - id: "last_available_death_rate"
                  format: 'real'
                  precision: 2
                - id: "last_available_date"
                  format: 'dataDMY'
          - template: "/thematic/casoscovid19?categorias=cd_municipio_ibge_dv,nm_municipio_uf,'obitos'-cd_indicador,last_available_date,last_available_confirmed,last_available_confirmed_per_100k_inhabitants,last_available_death_rate,estimated_population_2019,last_available_deaths-vl_indicador,latitude,longitude&valor=last_available_deaths&calcs=ln_norm_pos_part&partition=is_last&filtros=eq-place_type-'city',and,eq-is_last-TRUE,and,ne-latitude-0,and,ne-longitude-0,and,eq-cd_uf-{0}"
            args:
              - named_prop: 'cd_uf'
            options:
              formatters:
                - id: "estimated_population_2019"
                  format: 'inteiro'
                - id: "vl_indicador"
                  format: 'inteiro'
                - id: "last_available_deaths"
                  format: 'inteiro'
                - id: "last_available_confirmed"
                  format: 'inteiro'
                - id: "last_available_confirmed_per_100k_inhabitants"
                  format: 'real'
                  precision: 2
                - id: "last_available_death_rate"
                  format: 'real'
                  precision: 2
                - id: "last_available_date"
                  format: 'dataDMY'
        headers:
          - text: 'Município'
            value: 'nm_municipio_uf'
          - text: 'Indicador'
            value: 'cd_indicador'
          - text: 'Valor'
            value: 'fmt_vl_indicador'
          - text: 'População estimada (2019)'
            value: 'fmt_estimated_population_2019'
          - text: 'Casos confirmados'
            value: 'fmt_last_available_confirmed'
          - text: 'Óbitos confirmados'
            value: 'fmt_last_available_deaths'
          - text: 'Data coleta'
            value: 'fmt_last_available_date'
        chart_options:
          height_proportion: 1.77
          colorArray: ["rgba(21, 101, 192, 0.7)", "rgba(179, 9, 0, 0.7)"]
          indicadores: ["casos","obitos"]
          lat: 'latitude'
          long: 'longitude'
          value_field: 'vl_indicador'
        source:
          desc: "Brasil.io"
          link: "https://brasil.io/covid19/"
# ========================================================
      - id: "topo_alta_complex_uti_regic"
        chart_type: "MAP_POLYGON"
        title: 
          fixed: "Leitos de UTI / 10.000 hab. - Situação nos Pólos de Atendimento de Alta Complexidade"
        title_comment:
          template: "{0}, em {1}"
          api: 
            fixed: "/thematic/arranjoregic?categorias=cnes_dt_referencia&limit=1"
          args:
            - base_object: "localidade"
              named_prop: "nm_localidade"
            - named_prop: "cnes_dt_referencia"
              format: "dataDMY"
        # info:
        #   - type: "text"
        #     title: "Sobre"
        #     content:
        #       fixed: ""
        description:
          - type: "minicards"
            cards:
              - relevance: 'high'
                cls: 'xs12'
                api: 
                  template: "/thematic/arranjoregic?categorias=nm_municipio_uf_alta_complex&filtros=eq-cd_municipio_ibge_origem-{0}"
                  args:
                    - named_prop: "idLocalidadeD6"
                args:
                  - prop: "value"
                    template: "Arranjo Populacional<br/>{0}"
                    args:
                      - named_prop: 'nm_municipio_uf_alta_complex'
                        default: "Sem Registros"
                  - prop: "description"
                    fixed: 'Destino para atendimento de alta complexidade'
              - relevance: 'low'
                cls: 'xs12 md6'
                api: 
                  template: "/thematic/arranjoregic?categorias=qt_leitos_uti_arranjo&filtros=eq-cd_municipio_ibge_origem-{0}"
                  args:
                    - named_prop: "idLocalidadeD6"
                args:
                  - prop: "value"
                    named_prop: 'qt_leitos_uti_arranjo'
                    format: 'inteiro'
                    default: "Sem Registros"
                    zero: "Nenhum"
                  - prop: "description"
                    fixed: 'Número de Leitos de UTI'
              - relevance: 'low'
                cls: 'xs12 md6'
                api: 
                  template: "/thematic/arranjoregic?categorias=proporcao_leitos_uti_10k_arranjo&filtros=eq-cd_municipio_ibge_origem-{0}"
                  args:
                    - named_prop: "idLocalidadeD6"
                args:
                  - prop: "value"
                    named_prop: 'proporcao_leitos_uti_10k_arranjo'
                    format: 'real'
                    default: "Sem Registros"
                    zero: "Nenhum"
                  - prop: "description"
                    fixed: 'Número de Leitos de UTI'
                  - prop: "comment"
                    fixed: 'por 10.000 hab.'
              - relevance: 'low'
                cls: 'xs12 md6'
                api: 
                  template: "/thematic/arranjoregic?categorias=qt_municipios_arranjo&filtros=eq-cd_municipio_ibge_origem-{0}"
                  args:
                    - named_prop: "idLocalidadeD6"
                args:
                  - prop: "value"
                    named_prop: 'qt_municipios_arranjo'
                    format: 'inteiro'
                    default: "Sem Registros"
                    zero: "Nenhum"
                  - prop: "description"
                    fixed: 'Municípios atendidos'
              - relevance: 'low'
                cls: 'xs12 md6'
                api: 
                  template: "/thematic/arranjoregic?categorias=populacao_arranjo&filtros=eq-cd_municipio_ibge_origem-{0}"
                  args:
                    - named_prop: "idLocalidadeD6"
                args:
                  - prop: "value"
                    named_prop: 'populacao_arranjo'
                    format: 'inteiro'
                    collapse:
                      format: 'real'
                    default: "Sem Registros"
                    zero: "Nenhum"
                  - prop: "description"
                    fixed: 'População atendida'
          - type: "text"
            title: ""
            content:
              fixed: "Em destaque, o número de leitos de UTI (total e por 10 mil habitantes) no arranjo populacional do pólo de atendimento de saúde de alta complexidade que atende o município selecionado, assim como o número de municípios e da população atendida pelo pólo.
              A recomendação da OMS é de 1 a 3 leitos de UTI para cada 10 mil habitantes.
              No mapa, apresenta-se a perspectiva comparativa entre os arranjos populacionais dos pólos 
              de atendimento de saúde de alta complexidade, com escala 
              de cores que varia entre o vermelho (menor quantidade), o amarelo (média quantidade) 
              e o verde (maior quantidade), para a quantidade de leitos de UTI por 10.000 habitantes.<br/>"
        api: 
          - template: "/thematic/arranjoregic?categorias=nm_municipio_uf_origem-source_mun,populacao_arranjo,populacao_aglomerados_subnormais_arranjo,qt_municipios_arranjo,qt_leitos_uti_arranjo,qt_leitos_outros_arranjo,qt_respiradores_arranjo,qt_respiradores_uso_arranjo,qt_estabelecimentos_arranjo,proporcao_leitos_uti_10k_arranjo,proporcao_respiradores_uso_10k_arranjo,proporcao_respiradores_uso_arranjo,dt_coleta_covid_arranjo,qt_casos_covid_arranjo,qt_mortes_covid_arranjo,proporcao_mortes_covid_arranjo,nm_municipio_uf_alta_complex-target_mun,cd_municipio_ibge_alta_complex-target_cd_mun,cd_municipio_ibge_dv_alta_complex-cd_mun_ibge,latitude_alta_complex-lat,longitude_alta_complex-long&agregacao=DISTINCT&filtros=eq-cd_uf_origem-{0},and,nn-cd_municipio_ibge_dv_alta_complex"
            args:
              - named_prop: "cd_uf"
            options:
              recalc_min_max: true
              minmax_field: "proporcao_leitos_uti_10k_arranjo"
              calcs:
                - id: 'uti_level'
                  function: 'get_uti_level'
                  fn_args:
                    - named_prop: 'proporcao_leitos_uti_10k_arranjo'
                - id: "deviation"
                  function: "get_bipolar_scale"
                  fn_args: 
                    - fixed: 'proporcao_leitos_uti_10k_arranjo'
                    - fixed: 2
                - id: "perc_respiradores_uso"
                  function: "calc_proportion_ds"
                  fn_args: 
                    - named_prop: 'qt_respiradores_uso_arranjo'
                    - named_prop: 'qt_respiradores_arranjo'
              formatters:
                - id: "populacao_arranjo"
                  format: "inteiro"
                - id: "populacao_aglomerados_subnormais_arranjo"
                  format: "inteiro"
                - id: "qt_leitos_uti_arranjo"
                  format: "inteiro"
                - id: "qt_leitos_outros_arranjo"
                  format: "inteiro"
                - id: "qt_respiradores_arranjo"
                  format: "inteiro"
                - id: "qt_respiradores_uso_arranjo"
                  format: "inteiro"
                - id: "calc_perc_respiradores_uso"
                  format: "porcentagem"
                  multiplier: "100"
                - id: "proporcao_leitos_uti_10k_arranjo"
                  format: "real"
                - id: "proporcao_respiradores_uso_10k_arranjo"
                  format: "real"
                - id: "qt_casos_covid_arranjo"
                  format: "inteiro"
                - id: "qt_mortes_covid_arranjo"
                  format: "inteiro"
                - id: "proporcao_mortes_covid_arranjo"
                  format: "porcentagem"
                  multiplier: 100
                - id: "dt_coleta_covid_arranjo"
                  format: "dataDMY"
        headers:
          - text: 'Origem'
            align: 'left'
            value: 'source_mun'
          - text: 'Arranjo Populacional Destino para Atendimento de Alta Complexidade'
            align: 'left'
            value: 'target_mun'
          - text: 'Municípios atendidos'
            value: 'qt_municipios_arranjo'
          - text: 'População atendida'
            value: 'fmt_populacao_arranjo'
          - text: 'População aglomerados subnormais (2010)'
            value: 'fmt_populacao_aglomerados_subnormais_arranjo'
          - text: 'Qt Hospitais'
            value: 'qt_estabelecimentos_arranjo'
          - text: 'Qt Leitos UTI'
            value: 'fmt_qt_leitos_uti_arranjo'
          - text: 'Qt Leitos Outros'
            value: 'fmt_qt_leitos_outros_arranjo'
          - text: 'Leitos UTI/10.000 hab.'
            value: 'fmt_proporcao_leitos_uti_10k_arranjo'
          - text: 'Qtd Respiradores'
            value: 'fmt_qt_respiradores_arranjo'
          - text: 'Qtd Respiradores em condições de uso'
            value: 'fmt_qt_respiradores_uso_arranjo'
          - text: 'Respiradores em condições de uso (%):'
            value: 'fmt_calc_perc_respiradores_uso'
          - text: 'Respiradores em condições de uso/10.000 hab.'
            value: 'fmt_proporcao_respiradores_uso_10k_arranjo'
          - text: 'COVID-19 - Data coleta'
            value: 'fmt_dt_coleta_covid_arranjo'
          - text: 'COVID-19 - Casos confirmados'
            value: 'fmt_qt_casos_covid_arranjo'
          - text: 'COVID-19 - Óbitos confirmados'
            value: 'fmt_qt_mortes_covid_arranjo'
          - text: 'COVID-19 - Letalidade'
            value: 'fmt_proporcao_mortes_covid_arranjo'
        chart_options:
          height_proportion: 1.77
          id_field: 'cd_mun_ibge'
          lat: 'lat'
          long: 'long'
          topo_key: "CodReg"
          tooltip_function: 'obsCovidRegicUTITooltip'
          show_legend: true
          topology:
            scope: "regic"
            range: "uf"
          # value_field: 'calc_uti_level'
          value_field: 'calc_deviation'
          colorScale:
            name: "RdYlGn"
            range:
              min_value: -0.5
              max_value: 0.5
        source:
          desc: "IBGE - Regiões de Influência das Cidades - REGIC, Brasil.io e CNES - Cadastro Nacional de Estabelecimentos de Saúde"
          # link: "https://brasil.io/covid19/"
# ========================================================
      - id: "mapa_alta_complex_uti"
        chart_type: "MAP_MIGRATION"
        title: 
          fixed: "Leitos de UTI / 10.000 hab. - Situação nos Pólos de Atendimento de Alta Complexidade, conforme primeira opção de destino para atendimento"
        title_comment:
          template: "{0}, em {1}"
          api: 
            fixed: "/thematic/arranjoregic?categorias=cnes_dt_referencia&limit=1"
          args:
            - base_object: "localidade"
              named_prop: "nm_localidade"
            - named_prop: "cnes_dt_referencia"
              format: "dataDMY"
        # info:
        #   - type: "text"
        #     title: "Sobre"
        #     content:
        #       fixed: ""
        description:
          - type: "minicards"
            cards:
              - relevance: 'high'
                cls: 'xs12'
                api: 
                  template: "/thematic/arranjoregic?categorias=nm_municipio_uf_alta_complex&filtros=eq-cd_municipio_ibge_origem-{0}"
                  args:
                    - named_prop: "idLocalidadeD6"
                args:
                  - prop: "value"
                    template: "Arranjo Populacional<br/>{0}"
                    args:
                      - named_prop: 'nm_municipio_uf_alta_complex'
                        default: "Sem Registros"
                  - prop: "description"
                    fixed: 'Destino para atendimento de alta complexidade'
              - relevance: 'low'
                cls: 'xs12 md6'
                api: 
                  template: "/thematic/arranjoregic?categorias=qt_leitos_uti_arranjo&filtros=eq-cd_municipio_ibge_origem-{0}"
                  args:
                    - named_prop: "idLocalidadeD6"
                args:
                  - prop: "value"
                    named_prop: 'qt_leitos_uti_arranjo'
                    format: 'inteiro'
                    default: "Sem Registros"
                    zero: "Nenhum"
                  - prop: "description"
                    fixed: 'Número de Leitos de UTI'
              - relevance: 'low'
                cls: 'xs12 md6'
                api: 
                  template: "/thematic/arranjoregic?categorias=proporcao_leitos_uti_10k_arranjo&filtros=eq-cd_municipio_ibge_origem-{0}"
                  args:
                    - named_prop: "idLocalidadeD6"
                args:
                  - prop: "value"
                    named_prop: 'proporcao_leitos_uti_10k_arranjo'
                    format: 'real'
                    default: "Sem Registros"
                    zero: "Nenhum"
                  - prop: "description"
                    fixed: 'Número de Leitos de UTI'
                  - prop: "comment"
                    fixed: 'por 10.000 hab.'
              - relevance: 'low'
                cls: 'xs12 md6'
                api: 
                  template: "/thematic/arranjoregic?categorias=qt_municipios_arranjo&filtros=eq-cd_municipio_ibge_origem-{0}"
                  args:
                    - named_prop: "idLocalidadeD6"
                args:
                  - prop: "value"
                    named_prop: 'qt_municipios_arranjo'
                    format: 'inteiro'
                    default: "Sem Registros"
                    zero: "Nenhum"
                  - prop: "description"
                    fixed: 'Municípios atendidos'
              - relevance: 'low'
                cls: 'xs12 md6'
                api: 
                  template: "/thematic/arranjoregic?categorias=populacao_arranjo&filtros=eq-cd_municipio_ibge_origem-{0}"
                  args:
                    - named_prop: "idLocalidadeD6"
                args:
                  - prop: "value"
                    named_prop: 'populacao_arranjo'
                    format: 'inteiro'
                    collapse:
                      format: 'real'
                    default: "Sem Registros"
                    zero: "Nenhum"
                  - prop: "description"
                    fixed: 'População atendida'
          - type: "text"
            title: ""
            content:
              fixed: "Em destaque, o número de leitos de UTI (total e por 10 mil habitantes) no arranjo populacional do pólo de atendimento de saúde de alta complexidade que atende o município selecionado, assim como o número de municípios e da população atendida pelo pólo.
              A recomendação da OMS é de 1 a 3 leitos de UTI para cada 10 mil habitantes.
              O mapa apresenta as ligações de cada município com a primeira opção de destino para serviços de saúde de
              alta complexidade. A cor das ligações é baseada na quantidade de leitos de UTI por 10.000 habitantes no arranjo populacional do pólo destino, 
              e pode ser: vermelha (fora do recomendado), amarela (dentro do recomendado) ou verde (acima do recomendado).<br/>"
        api: 
          - template: "/thematic/arranjoregic?categorias=populacao_arranjo,populacao_aglomerados_subnormais_arranjo,qt_municipios_arranjo,qt_leitos_uti_arranjo,qt_leitos_outros_arranjo,qt_respiradores_arranjo,qt_respiradores_uso_arranjo,qt_estabelecimentos_arranjo,proporcao_leitos_uti_10k_arranjo,proporcao_respiradores_uso_10k_arranjo,proporcao_respiradores_uso_arranjo,dt_coleta_covid_arranjo,qt_casos_covid_arranjo,qt_mortes_covid_arranjo,proporcao_mortes_covid_arranjo,nm_municipio_uf_origem-source_mun,nm_municipio_uf_alta_complex-target_mun,cd_municipio_ibge_origem-source_cd_mun,cd_municipio_ibge_alta_complex-target_cd_mun,latitude_origem-source_lat,latitude_alta_complex-target_lat,longitude_origem-source_long,longitude_alta_complex-target_long&agregacao=count&filtros=eq-cd_uf_origem-{0},and,ne-cd_municipio_ibge_origem-cd_municipio_ibge_alta_complex"
            args:
              - named_prop: "cd_uf"
          - template: "/thematic/arranjoregic?categorias=populacao_arranjo,populacao_aglomerados_subnormais_arranjo,qt_municipios_arranjo,qt_leitos_uti_arranjo,qt_leitos_outros_arranjo,qt_respiradores_arranjo,qt_respiradores_uso_arranjo,qt_estabelecimentos_arranjo,proporcao_leitos_uti_10k_arranjo,proporcao_respiradores_uso_10k_arranjo,proporcao_respiradores_uso_arranjo,dt_coleta_covid_arranjo,qt_casos_covid_arranjo,qt_mortes_covid_arranjo,proporcao_mortes_covid_arranjo,nm_municipio_uf_origem-source_mun,nm_municipio_uf_alta_complex-target_mun,cd_municipio_ibge_origem-source_cd_mun,cd_municipio_ibge_alta_complex-target_cd_mun,latitude_origem-source_lat,latitude_alta_complex-target_lat,longitude_origem-source_long,longitude_alta_complex-target_long&agregacao=count&filtros=ne-cd_uf_origem-{0},and,eq-cd_uf_alta_complex-{0},and,ne-cd_municipio_ibge_origem-cd_municipio_ibge_alta_complex"
            args:
              - named_prop: "cd_uf"
        api_options:
          calcs:
            - id: 'uti_level'
              function: 'get_uti_level'
              fn_args:
                - named_prop: 'proporcao_leitos_uti_10k_arranjo'
            - id: "perc_respiradores_uso"
              function: "calc_proportion_ds"
              fn_args: 
                - named_prop: 'qt_respiradores_uso_arranjo'
                - named_prop: 'qt_respiradores_arranjo'
          formatters:
            - id: "populacao_arranjo"
              format: "inteiro"
            - id: "populacao_aglomerados_subnormais_arranjo"
              format: "inteiro"
            - id: "qt_leitos_uti_arranjo"
              format: "inteiro"
            - id: "qt_leitos_outros_arranjo"
              format: "inteiro"
            - id: "qt_respiradores_arranjo"
              format: "inteiro"
            - id: "qt_respiradores_uso_arranjo"
              format: "inteiro"
            - id: "calc_perc_respiradores_uso"
              format: "porcentagem"
              multiplier: "100"
            - id: "proporcao_leitos_uti_10k_arranjo"
              format: "real"
            - id: "proporcao_respiradores_uso_10k_arranjo"
              format: "real"
            - id: "qt_casos_covid_arranjo"
              format: "inteiro"
            - id: "qt_mortes_covid_arranjo"
              format: "inteiro"
            - id: "proporcao_mortes_covid_arranjo"
              format: "porcentagem"
              multiplier: 100
            - id: "dt_coleta_covid_arranjo"
              format: "dataDMY"
        headers:
          - text: 'Município origem'
            align: 'left'
            value: 'source_mun'
          - text: 'Arranjo Populacional Destino para Atendimento de Alta Complexidade'
            align: 'left'
            value: 'target_mun'
          - text: 'Qt Leitos UTI'
            value: 'fmt_qt_leitos_uti_arranjo'
          - text: 'Qt Leitos Outros'
            value: 'fmt_qt_leitos_outros_arranjo'
          - text: 'Leitos UTI/10.000 hab. no Arranjo'
            align: 'left'
            value: 'fmt_proporcao_leitos_uti_10k_arranjo'
          - text: 'Situação UTI no Arranjo'
            align: 'left'
            value: 'calc_uti_level'
          - text: 'Municípios atendidos'
            value: 'qt_municipios_arranjo'
          - text: 'População atendida'
            value: 'fmt_populacao_arranjo'
          - text: 'População aglomerados subnormais (2010)'
            value: 'fmt_populacao_aglomerados_subnormais_arranjo'
          - text: 'Qt Hospitais'
            value: 'qt_estabelecimentos_arranjo'
          - text: 'Qtd Respiradores'
            value: 'fmt_qt_respiradores_arranjo'
          - text: 'Qtd Respiradores em condições de uso'
            value: 'fmt_qt_respiradores_uso_arranjo'
          - text: 'Respiradores em condições de uso (%):'
            value: 'fmt_calc_perc_respiradores_uso'
          - text: 'Respiradores em condições de uso/10.000 hab.'
            value: 'fmt_proporcao_respiradores_uso_10k_arranjo'
          - text: 'COVID-19 - Data coleta'
            value: 'fmt_dt_coleta_covid_arranjo'
          - text: 'COVID-19 - Casos confirmados'
            value: 'fmt_qt_casos_covid_arranjo'
          - text: 'COVID-19 - Óbitos confirmados'
            value: 'fmt_qt_mortes_covid_arranjo'
          - text: 'COVID-19 - Letalidade'
            value: 'fmt_proporcao_mortes_covid_arranjo'
        chart_options:
          height_proportion: 1.77
          id_field: 'calc_uti_level'
          value_field: 'agr_count'
          loc_size_field: 'agr_count'
          show_markers: true
          radius:
            base: 10000
            multiplier: 2000
          path:
            multiplier: 4
            animation:
              base_duration: 10000
          source:
            lat: 'source_lat'
            long: 'source_long'
            id: 'source_cd_mun'
          target:
            lat: 'target_lat'
            long: 'target_long'
            id: 'target_cd_mun'
            tooltip_function: 'obsCovidRegicUTITooltip'
            # tooltip_items:
            #   - text: 'Pólo Alta Complexidade'
            #     value: 'target_mun'
            #   # - text: 'População Estimada'
            #   #   value: 'fmt_estimaded_population'
          indicadores: ['Abaixo do recomendado','Dentro do recomendado','Acima do recomendado']
          legendArray: ['Abaixo do recomendado','Dentro do recomendado','Acima do recomendado']
          colorArray: ["rgba(179, 9, 0, 0.7)","#fbc11a","green"]
        source:
          desc: "IBGE - Regiões de Influência das Cidades - REGIC, Brasil.io e CNES - Cadastro Nacional de Estabelecimentos de Saúde"
          # link: "https://brasil.io/covid19/"
# # ========================================================
#       - id: "topo_alta_complex_uti"
#         chart_type: "MAP_TOPOJSON"
#         title: 
#           fixed: "Leitos de UTI / 10.000 hab. - Situação nos Pólos de Atendimento de Alta Complexidade"
#         title_comment:
#           template: "{0}, março 2020"
#           args:
#             - base_object: "localidade"
#               named_prop: "nm_localidade"
#         # info:
#         #   - type: "text"
#         #     title: "Sobre"
#         #     content:
#         #       fixed: ""
#         description:
#           - type: "minicards"
#             cards:
#               - relevance: 'high'
#                 cls: 'xs12'
#                 api: 
#                   template: "/thematic/arranjoregic?categorias=nm_municipio_uf_alta_complex&filtros=eq-cd_municipio_ibge_origem-{0}"
#                   args:
#                     - named_prop: "idLocalidadeD6"
#                 args:
#                   - prop: "value"
#                     template: "Arranjo Populacional<br/>{0}"
#                     args:
#                       - named_prop: 'nm_municipio_uf_alta_complex'
#                         default: "Sem Registros"
#                   - prop: "description"
#                     fixed: 'Destino para atendimento de alta complexidade'
#               - relevance: 'low'
#                 cls: 'xs12 md6'
#                 api: 
#                   template: "/thematic/arranjoregic?categorias=qt_leitos_uti_arranjo&filtros=eq-cd_municipio_ibge_origem-{0}"
#                   args:
#                     - named_prop: "idLocalidadeD6"
#                 args:
#                   - prop: "value"
#                     named_prop: 'qt_leitos_uti_arranjo'
#                     format: 'inteiro'
#                     default: "Sem Registros"
#                     zero: "Nenhum"
#                   - prop: "description"
#                     fixed: 'Número de Leitos de UTI'
#               - relevance: 'low'
#                 cls: 'xs12 md6'
#                 api: 
#                   template: "/thematic/arranjoregic?categorias=proporcao_leitos_uti_10k_arranjo&filtros=eq-cd_municipio_ibge_origem-{0}"
#                   args:
#                     - named_prop: "idLocalidadeD6"
#                 args:
#                   - prop: "value"
#                     named_prop: 'proporcao_leitos_uti_10k_arranjo'
#                     format: 'real'
#                     default: "Sem Registros"
#                     zero: "Nenhum"
#                   - prop: "description"
#                     fixed: 'Número de Leitos de UTI'
#                   - prop: "comment"
#                     fixed: 'por 10.000 hab.'
#               - relevance: 'low'
#                 cls: 'xs12 md6'
#                 api: 
#                   template: "/thematic/arranjoregic?categorias=qt_municipios_arranjo&filtros=eq-cd_municipio_ibge_origem-{0}"
#                   args:
#                     - named_prop: "idLocalidadeD6"
#                 args:
#                   - prop: "value"
#                     named_prop: 'qt_municipios_arranjo'
#                     format: 'inteiro'
#                     default: "Sem Registros"
#                     zero: "Nenhum"
#                   - prop: "description"
#                     fixed: 'Municípios atendidos'
#               - relevance: 'low'
#                 cls: 'xs12 md6'
#                 api: 
#                   template: "/thematic/arranjoregic?categorias=populacao_arranjo&filtros=eq-cd_municipio_ibge_origem-{0}"
#                   args:
#                     - named_prop: "idLocalidadeD6"
#                 args:
#                   - prop: "value"
#                     named_prop: 'populacao_arranjo'
#                     format: 'inteiro'
#                     collapse:
#                       format: 'real'
#                     default: "Sem Registros"
#                     zero: "Nenhum"
#                   - prop: "description"
#                     fixed: 'População atendida'
#           - type: "text"
#             title: ""
#             content:
#               fixed: "Texto..."
#         api: 
#           - template: "/thematic/arranjoregic?categorias=populacao_estimada_mun_origem,qt_leitos_uti_arranjo,proporcao_leitos_uti_10k_arranjo,nm_municipio_uf_origem-source_mun,nm_municipio_uf_alta_complex-target_mun,cd_municipio_ibge_dv_origem-cd_mun_ibge,cd_municipio_ibge_dv_alta_complex-target_cd_mun,latitude_origem-source_lat,latitude_alta_complex-target_lat,longitude_origem-source_long,longitude_alta_complex-target_long&filtros=eq-cd_uf_origem-{0}"
#             args:
#               - named_prop: "cd_uf"
#             options:
#               minmax_field: "proporcao_leitos_uti_10k_arranjo"
#               calcs:
#                 - id: 'uti_level'
#                   function: 'get_uti_level'
#                   fn_args:
#                     - named_prop: 'proporcao_leitos_uti_10k_arranjo'
#         headers:
#           - text: 'Município origem'
#             align: 'left'
#             value: 'source_mun'
#           - text: 'População estimada (2019)'
#             value: 'populacao_estimada_mun_origem'
#             format: 'inteiro'
#           - text: 'Pólo Destino para Atendimento de Alta Complexidade'
#             align: 'left'
#             value: 'target_mun'
#           - text: 'Qtd Leitos UTI no Pólo'
#             value: 'qt_leitos_uti_arranjo'
#             format: 'inteiro'
#           - text: 'Leitos UTI/10.000 hab. no Pólo'
#             value: 'proporcao_leitos_uti_10k_arranjo'
#             format: 'real'
#           - text: 'Situação no Pólo'
#             value: 'calc_uti_level'
#         chart_options:
#           id_field: 'cd_mun_ibge'
#           topo_key: "codarea"
#           value_field: 'calc_uti_level'
#           colorScale: 
#             type: "fixed"
#             color_array: 
#               "Abaixo do recomendado": "rgba(179, 9, 0, 0.7)"
#               "Dentro do recomendado": "#fbc11a"
#               "Acima do recomendado": "green"
#         source:
#           desc: "fonte"
#           link: ""
# ========================================================
      - id: "topo_alta_complex_uti2"
        chart_type: "MAP_TOPOJSON"
        title: 
          fixed: "Leitos de UTI / 10.000 hab. - Situação do Município conforme Pólo de Atendimento de Alta Complexidade"
        title_comment:
          template: "{0}, em {1}"
          api: 
            fixed: "/thematic/arranjoregic?categorias=cnes_dt_referencia&limit=1"
          args:
            - base_object: "localidade"
              named_prop: "nm_localidade"
            - named_prop: "cnes_dt_referencia"
              format: "dataDMY"
        # info:
        #   - type: "text"
        #     title: "Sobre"
        #     content:
        #       fixed: ""
        description:
          - type: "minicards"
            cards:
              - relevance: 'high'
                cls: 'xs12'
                api: 
                  template: "/thematic/arranjoregic?categorias=nm_municipio_uf_alta_complex&filtros=eq-cd_municipio_ibge_origem-{0}"
                  args:
                    - named_prop: "idLocalidadeD6"
                args:
                  - prop: "value"
                    template: "Arranjo Populacional<br/>{0}"
                    args:
                      - named_prop: 'nm_municipio_uf_alta_complex'
                        default: "Sem Registros"
                  - prop: "description"
                    fixed: 'Destino para atendimento de alta complexidade'
              - relevance: 'low'
                cls: 'xs12 md6'
                api: 
                  template: "/thematic/arranjoregic?categorias=qt_leitos_uti_arranjo&filtros=eq-cd_municipio_ibge_origem-{0}"
                  args:
                    - named_prop: "idLocalidadeD6"
                args:
                  - prop: "value"
                    named_prop: 'qt_leitos_uti_arranjo'
                    format: 'inteiro'
                    default: "Sem Registros"
                    zero: "Nenhum"
                  - prop: "description"
                    fixed: 'Número de Leitos de UTI'
              - relevance: 'low'
                cls: 'xs12 md6'
                api: 
                  template: "/thematic/arranjoregic?categorias=proporcao_leitos_uti_10k_arranjo&filtros=eq-cd_municipio_ibge_origem-{0}"
                  args:
                    - named_prop: "idLocalidadeD6"
                args:
                  - prop: "value"
                    named_prop: 'proporcao_leitos_uti_10k_arranjo'
                    format: 'real'
                    default: "Sem Registros"
                    zero: "Nenhum"
                  - prop: "description"
                    fixed: 'Número de Leitos de UTI'
                  - prop: "comment"
                    fixed: 'por 10.000 hab.'
              - relevance: 'low'
                cls: 'xs12 md6'
                api: 
                  template: "/thematic/arranjoregic?categorias=qt_municipios_arranjo&filtros=eq-cd_municipio_ibge_origem-{0}"
                  args:
                    - named_prop: "idLocalidadeD6"
                args:
                  - prop: "value"
                    named_prop: 'qt_municipios_arranjo'
                    format: 'inteiro'
                    default: "Sem Registros"
                    zero: "Nenhum"
                  - prop: "description"
                    fixed: 'Municípios atendidos'
              - relevance: 'low'
                cls: 'xs12 md6'
                api: 
                  template: "/thematic/arranjoregic?categorias=populacao_arranjo&filtros=eq-cd_municipio_ibge_origem-{0}"
                  args:
                    - named_prop: "idLocalidadeD6"
                args:
                  - prop: "value"
                    named_prop: 'populacao_arranjo'
                    format: 'inteiro'
                    collapse:
                      format: 'real'
                    default: "Sem Registros"
                    zero: "Nenhum"
                  - prop: "description"
                    fixed: 'População atendida'
          - type: "text"
            title: ""
            content:
              fixed: "Em destaque, o número de leitos de UTI (total e por 10 mil habitantes) no arranjo populacional do pólo de atendimento de saúde de alta complexidade que atende o município selecionado, assim como o número de municípios e da população atendida pelo pólo.
              A recomendação da OMS é de 1 a 3 leitos de UTI para cada 10 mil habitantes.
              No mapa, apresenta-se a perspectiva comparativa entre os municípios da unidade federativa.
              A escala de cores varia entre o vermelho (menor quantidade), o amarelo (média quantidade) 
              e o verde (maior quantidade), para a quantidade de leitos de UTI por 10.000 habitantes no arranjo populacional do pólo de 
              atendimento de saúde de alta complexidade que atende o município.<br/>"
        api: 
          - template: "/thematic/arranjoregic?categorias=populacao_arranjo,qt_municipios_arranjo,populacao_estimada_mun_origem,qt_leitos_uti_arranjo,proporcao_leitos_uti_10k_arranjo,nm_municipio_uf_origem-source_mun,nm_municipio_uf_alta_complex-target_mun,cd_municipio_ibge_dv_origem-cd_mun_ibge,cd_municipio_ibge_dv_alta_complex-target_cd_mun,latitude_origem-source_lat,latitude_alta_complex-target_lat,longitude_origem-source_long,longitude_alta_complex-target_long&filtros=eq-cd_uf_origem-{0}"
            args:
              - named_prop: "cd_uf"
            options:
              recalc_min_max: true
              minmax_field: "proporcao_leitos_uti_10k_arranjo"
              calcs:
                - id: 'uti_level'
                  function: 'get_uti_level'
                  fn_args:
                    - named_prop: 'proporcao_leitos_uti_10k_arranjo'
                - id: "deviation_crescimento"
                  function: "get_bipolar_scale"
                  fn_args: 
                    - fixed: 'proporcao_leitos_uti_10k_arranjo'
                    - fixed: 2
              formatters:
                - id: "populacao_arranjo"
                  format: "inteiro"
        headers:
          - text: 'Município origem'
            align: 'left'
            value: 'source_mun'
          - text: 'População estimada (2019)'
            value: 'populacao_estimada_mun_origem'
            format: 'inteiro'
          - text: 'Arranjo Populacional  Destino para Atendimento de Alta Complexidade'
            align: 'left'
            value: 'target_mun'
          - text: 'Municípios atendidos'
            value: 'qt_municipios_arranjo'
          - text: 'População atendida'
            value: 'fmt_populacao_arranjo'
          - text: 'Qtd Leitos UTI no Arranjo'
            value: 'qt_leitos_uti_arranjo'
            format: 'inteiro'
          - text: 'Leitos UTI/10.000 hab. no Arranjo'
            value: 'proporcao_leitos_uti_10k_arranjo'
            format: 'real'
          - text: 'Situação no Arranjo'
            value: 'calc_uti_level'
        chart_options:
          id_field: 'cd_mun_ibge'
          topo_key: "codarea"
          # value_field: 'calc_uti_level'
          value_field: 'calc_deviation_crescimento'
          colorScale:
            name: "RdYlGn"
            range:
              min_value: -0.5
              max_value: 0.5
          # colorScale: 
          #   type: "fixed"
          #   color_array: 
          #     "Abaixo": "rgba(179, 9, 0, 0.7)"
          #     "Dentro": "#fbc11a"
          #     "Acima": "green"
        source:
          desc: "IBGE - Regiões de Influência das Cidades - REGIC, Brasil.io e CNES - Cadastro Nacional de Estabelecimentos de Saúde"
          # link: "https://brasil.io/covid19/"
