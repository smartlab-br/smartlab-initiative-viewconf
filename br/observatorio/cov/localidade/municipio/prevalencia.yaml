# ========================================================
principais:
  - relevance: 'lead' 
    cls: 'xs12 xl6'
    rowClass: "pt-0 px-3 pb-5"
    api: 
      template: "/thematic/casoscovid19?categorias=city_ibge_code,date_info,last_available_confirmed&filtros=eq-city_ibge_code-{0},and,eq-place_type-'city',and,eq-is_last-TRUE"
      args:
        - named_prop: "idLocalidadeD6"
    args:
      - prop: "value"
        named_prop: 'last_available_confirmed'
        format: 'inteiro'
        default: 'Nenhum'
        zero: 'Nenhum'
      - prop: "description"
        fixed: "Casos Confirmados"
      - prop: 'comment'
        named_prop: 'date_info'
        format: 'dataDMY'
    # chart:
    #   id: "line_te_rgt"
    #   type: "LINE"
    #   api: 
    #     template: "/te/indicadoresmunicipais?categorias=cd_indicador,nu_competencia,vl_indicador&filtros=eq-cd_mun_ibge_dv-{0},and,eq-cd_indicador-'te_rgt'"
    #     args:
    #       - named_prop: "idLocalidade"
    #     options:
    #       formatters:
    #         - id: "vl_indicador"
    #           format: 'inteiro'
    #   headers:
    #     - text: 'Ano'
    #       align: 'left'
    #       value: 'nu_competencia'
    #     - text: 'Nº resgatados do trabalho escravo'
    #       value: 'fmt_vl_indicador'
    #   options:
    #     id: 'cd_indicador'
    #     x: 'nu_competencia'
    #     y: "vl_indicador"
    #     x_options:
    #       axis: false
    #     y_options:
    #       axis: false
    #     hide_legend: true
    #     color: "#00C853"
  - relevance: 'lead' 
    cls: 'xs12 xl6'
    rowClass: "pt-0 px-3 pb-5"
    api: 
      template: "/thematic/casoscovid19?categorias=city_ibge_code,date_info,last_available_deaths&filtros=eq-city_ibge_code-{0},and,eq-place_type-'city',and,eq-is_last-TRUE"
      args:
        - named_prop: "idLocalidadeD6"
    args:
      - prop: "value"
        named_prop: 'last_available_deaths'
        format: 'inteiro'
        default: 'Nenhum'
        zero: 'Nenhum'
      - prop: "description"
        fixed: "Óbitos Confirmados"
      - prop: 'comment'
        named_prop: 'date_info'
        format: 'dataDMY'
# ========================================================
secoes:
  - id: 'prevalencia_main_story'
    name: "Contexto Geográfico"
    cards:
# ========================================================
      - id: "mapa_casos"
        title: 
          fixed: "Casos confirmados"
        title_comment:
          template: "{0}, {1}"
          api: 
            template: "/thematic/casoscovid19?categorias=last_available_date&filtros=eq-place_type-'city',and,eq-is_last-TRUE,and,eq-cd_municipio_ibge_dv-{0}"
            args:
              - named_prop: 'idLocalidade'
          args:
            - base_object: "localidade"
              named_prop: "nm_localidade"
            - named_prop: "last_available_date"
              format: 'dataDMY'
        # info:
        #   - type: "text"
        #     title: "Sobre a métrica"
        #     content:
        #       fixed: ""
        description:
          - type: "minicards"
            cards:
              - relevance: 'high'
                cls: 'xs12 md6'
                api: 
                  template: "/thematic/casoscovid19?categorias=last_available_date,last_available_confirmed&filtros=eq-place_type-'city',and,eq-is_last-TRUE,and,eq-cd_municipio_ibge_dv-{0}"
                  args:
                    - named_prop: 'idLocalidade'
                args:
                  - prop: "value"
                    named_prop: 'last_available_confirmed'
                    format: 'inteiro'
                    default: "Sem Registros"
                    zero: "Nenhum"
                  - prop: "description"
                    fixed: 'Casos confirmados'
              - relevance: 'high'
                cls: 'xs12 md6'
                api: 
                  template: "/thematic/casoscovid19?categorias=last_available_date,last_available_deaths&filtros=eq-place_type-'city',and,eq-is_last-TRUE,and,eq-cd_municipio_ibge_dv-{0}"
                  args:
                    - named_prop: 'idLocalidade'
                args:
                  - prop: "value"
                    named_prop: 'last_available_deaths'
                    format: 'inteiro'
                    default: "Sem Registros"
                    zero: "Nenhum"
                  - prop: "description"
                    fixed: 'Óbitos confirmados'
          - type: "text"
            title: ""
            content:
              fixed: "Em destaque, o número de casos confirmados.<br/>"
        chart_type: "MAP_TOPOJSON"
        api: 
          template: "/thematic/casoscovid19?categorias=cd_municipio_ibge_dv,city,last_available_date,last_available_confirmed,last_available_deaths,last_available_confirmed_per_100k_inhabitants,last_available_death_rate&filtros=eq-place_type-'city',and,eq-is_last-TRUE,and,eq-cd_uf-{0}"
          args:
            - named_prop: 'cd_uf'
          options:
            calcs:
              - id: "deviation_obitos"
                function: "get_log"
                fn_args:
                  - fixed: "last_available_deaths"
            formatters:
              - id: "last_available_deaths"
                format: 'inteiro'
              - id: "last_available_confirmed"
                format: 'inteiro'
        headers:
          - text: 'Município'
            align: 'left'
            value: 'city'
          - text: 'Casos confirmados'
            value: 'fmt_last_available_confirmed'
          - text: 'Óbitos confirmados'
            value: 'fmt_last_available_deaths'
          - text: 'Casos confirmados/100.000 hab.'
            value: 'last_available_confirmed_per_100k_inhabitants'
            format: 'real'
            precision: 2
          - text: 'Óbitos confirmados/100.000 hab.'
            value: 'last_available_death_rate'
            format: 'real'
            precision: 2
          - text: 'Data coleta'
            value: 'last_available_date'
            format: 'dataDMY'
        chart_options:
          id_field: 'cd_municipio_ibge_dv'
          topo_key: "codarea"
          value_field: 'calc_deviation_obitos'
          colorScale:
            name: 'Reds'
# ========================================================
      - id: "mapa_prev_brasil"
        chart_type: "MAP_BUBBLES"
        title: 
          fixed: "Distribuição Geográfica"
        title_comment:
          template: "{0}, {1}"
          api: 
            template: "/thematic/casoscovid19?categorias=last_available_date&filtros=eq-place_type-'city',and,eq-is_last-TRUE,and,eq-cd_municipio_ibge_dv-{0}"
            args:
              - named_prop: 'idLocalidade'
          args:
            - base_object: "localidade"
              named_prop: "nm_localidade"
            - named_prop: "last_available_date"
              format: 'dataDMY'
        # info:
        #   - type: "text"
        #     title: "Sobre"
        #     content:
        #       fixed: ""
        api:
        # &calcs=ln_norm_pos_part&partition=cd_municipio_ibge_dv
          - template: "/thematic/casoscovid19?categorias=cd_municipio_ibge_dv,nm_municipio_uf,'casos'-codigo,last_available_date,last_available_deaths,last_available_confirmed_per_100k_inhabitants,last_available_death_rate,last_available_confirmed-valor,latitude,longitude&valor=last_available_confirmed&calcs=ln_norm_pos_part&partition=is_last&filtros=eq-place_type-'city',and,eq-is_last-TRUE,and,ne-latitude-0,and,ne-longitude-0,and,eq-cd_uf-{0}"
            args:
              - named_prop: 'cd_uf'
          - template: "/thematic/casoscovid19?categorias=cd_municipio_ibge_dv,nm_municipio_uf,'obitos'-codigo,last_available_date,last_available_confirmed,last_available_confirmed_per_100k_inhabitants,last_available_death_rate,last_available_deaths-valor,latitude,longitude&valor=last_available_deaths&calcs=ln_norm_pos_part&partition=is_last&filtros=eq-place_type-'city',and,eq-is_last-TRUE,and,ne-latitude-0,and,ne-longitude-0,and,eq-cd_uf-{0}"
            args:
              - named_prop: 'cd_uf'
          - template: "/thematic/casoscovid19?categorias=cd_municipio_ibge_dv,nm_municipio_uf,'conf100M'-codigo,last_available_date,last_available_confirmed,last_available_deaths,last_available_death_rate,last_available_confirmed_per_100k_inhabitants-valor,latitude,longitude&valor=last_available_confirmed_per_100k_inhabitants&calcs=ln_norm_pos_part&partition=is_last&filtros=eq-place_type-'city',and,eq-is_last-TRUE,and,ne-latitude-0,and,ne-longitude-0,and,eq-cd_uf-{0}"
            args:
              - named_prop: 'cd_uf'
          - template: "/thematic/casoscovid19?categorias=cd_municipio_ibge_dv,nm_municipio_uf,'obitos100M'-codigo,last_available_date,last_available_confirmed,last_available_deaths,last_available_confirmed_per_100k_inhabitants,last_available_death_rate-valor,latitude,longitude&valor=last_available_death_rate&calcs=ln_norm_pos_part&partition=is_last&filtros=eq-place_type-'city',and,eq-is_last-TRUE,and,ne-latitude-0,and,ne-longitude-0,and,eq-cd_uf-{0}"
            args:
              - named_prop: 'cd_uf'
        chart_options:
          colorArray: ["rgba(179, 9, 0, 0.7)", "rgba(21, 101, 192, 0.7)", "rgba(25, 125, 25, 0.7)", "#9C27B0"]
          indicadores: ["obitos","casos","conf100M", "obitos100M"]
          lat: 'latitude'
          long: 'longitude'
          id_field: 'codigo' 
          clickable: true
          height_proportion: 1
          radius:
            base: 10000
            multiplier: 800000
          tiles_url: "https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}"
          tiles_attribution: "Tiles &copy; Esri &mdash; Source: Esri, DeLorme, NAVTEQ, USGS, Intermap, iPC, NRCAN, Esri Japan, METI, Esri China (Hong Kong), Esri (Thailand), TomTom, 2012"
        headers:
          - text: 'Município'
            value: 'nm_municipio_uf'
          - text: 'Casos confirmados'
            value: 'last_available_confirmed'
            format: 'inteiro'
          - text: 'Óbitos confirmados'
            value: 'last_available_deaths'
            format: 'inteiro'
          - text: 'Casos confirmados/100.000 hab.'
            value: 'last_available_confirmed_per_100k_inhabitants'
            format: 'real'
            precision: 2
          - text: 'Óbitos confirmados/100.000 hab.'
            value: 'last_available_death_rate'
            format: 'real'
            precision: 2
          - text: 'Data coleta'
            value: 'last_available_date'
            format: 'dataDMY'
        source:
          desc: "fonte"
          link: ""
        description:
          - type: "text"
            title: ""
            content:
              fixed: "Texto..."
          - id: "selectlayer"
            type: "switch-group"
            switches:
              - id: "casos"
                default: true
                color: "light-blue"
                label: "CASOS CONFIRMADOS"
              - id: "obitos"
                default: true
                color: "red"
                label: "ÓBITOS CONFIRMADOS"
              - id: "conf100M"
                default: false
                color: "green accent-4"
                label: "CASOS CONFIRMADOS/100.000 hab."
              - id: "obitos100M"
                default: false
                color: "purple"
                label: "ÓBITOS CONFIRMADOS/100.000 hab."
            event: 'selection'
# ========================================================
      - id: "mapa_prev_brasil_calor"
        chart_type: "MAP_HEAT"
        title: 
          fixed: "Mapa de Calor"
        title_comment:
          template: "{0}, {1}"
          api: 
            template: "/thematic/casoscovid19?categorias=last_available_date&filtros=eq-place_type-'city',and,eq-is_last-TRUE,and,eq-cd_municipio_ibge_dv-{0}"
            args:
              - named_prop: 'idLocalidade'
          args:
            - base_object: "localidade"
              named_prop: "nm_localidade"
            - named_prop: "last_available_date"
              format: 'dataDMY'
        # info:
        #   - type: "text"
        #     title: "Sobre"
        #     content:
        #       fixed: ""
        api:
          - template: "/thematic/casoscovid19?categorias=cd_municipio_ibge_dv,nm_municipio_uf,'casos'-cd_indicador,last_available_date,last_available_deaths,last_available_confirmed_per_100k_inhabitants,last_available_death_rate,last_available_confirmed-vl_indicador,latitude,longitude&valor=last_available_confirmed&calcs=ln_norm_pos_part&partition=is_last&filtros=eq-place_type-'city',and,eq-is_last-TRUE,and,ne-latitude-0,and,ne-longitude-0,and,eq-cd_uf-{0}"
            args:
              - named_prop: 'cd_uf'
          - template: "/thematic/casoscovid19?categorias=cd_municipio_ibge_dv,nm_municipio_uf,'obitos'-cd_indicador,last_available_date,last_available_confirmed,last_available_confirmed_per_100k_inhabitants,last_available_death_rate,last_available_deaths-vl_indicador,latitude,longitude&valor=last_available_deaths&calcs=ln_norm_pos_part&partition=is_last&filtros=eq-place_type-'city',and,eq-is_last-TRUE,and,ne-latitude-0,and,ne-longitude-0,and,eq-cd_uf-{0}"
            args:
              - named_prop: 'cd_uf'
        chart_options:
          colorArray: ["rgba(21, 101, 192, 0.7)", "rgba(179, 9, 0, 0.7)"]
          height_proportion: 1
          indicadores: ["casos","obitos"]
          lat: 'latitude'
          long: 'longitude'
          value_field: 'vl_indicador'
        source:
          desc: ""
          link: ""
        description:
          - type: "text"
            title: ""
            content:
              fixed: "Texto..."
          - id: "selectlayer"
            type: "radio"
            items:
              - id: "casos"
                cls: "xs12"
                label: "Casos confirmados"
                color: "light-blue"
                value: "casos"
                default: true
              - id: "obitos"
                cls: "xs12"
                label: "Óbitos confirmados"
                color: "red"
                value: "obitos"
            event: 'selection'
# # ========================================================
#       - id: "mapa_prev_brasil_cluster"
#         chart_type: "MAP_CLUSTER"
#         title: 
#           fixed: "Mapa de agrupamentos de municípios próximos"
#         title_comment:
#           template: "Brasil, {0} a {1}"
#           api: 
#             fixed: "/te/indicadoresnacionais?categorias=nu_competencia_min,nu_competencia_max&limit=1&filtros=eq-cd_indicador-'te_rgt'"
#           args:
#             - named_prop: "nu_competencia_min"
#             - named_prop: "nu_competencia_max"
#         info:
#           - type: "text"
#             title: "Sobre"
#             content:
#               fixed: "O total de resgates foi calculado com base em informações extraídas do Banco de Dados COETE (MTb), que inclui beneficiários e não-beneficiários do Seguro-Desemprego modalidade trabalhador resgatado. O total de egressos com naturalidade e residência declaradas foi calculado com base nos registros administrativos do seguro-desemprego nessa modalidade, isto é, restringe-se aos trabalhadores habilitados ao recebimento do benefício. Diferenças entre os números se explicam por padrões de lançamento desses dados e pelas normas referentes à concessão do benefício vigentes. Entre 1995 a 2017, foram contabilizados mais de 50 mil resgates. Por sua maior consistência, este Observatório analisou dados desde 2003 (ano de lançamento do I Plano Nacional de Erradicação do Trabalho Escravo)."
#         api:
#           fixed: "/te/indicadoresmunicipais?categorias=latitude,longitude,cd_mun_ibge,nm_municipio,cd_indicador&valor=vl_indicador&agregacao=sum&filtros=nn-vl_indicador,and,in-cd_indicador-'te_rgt'-'te_nat'-'te_res'&calcs=ln_norm_pos_part"
#         chart_options:
#           colorArray: ["rgba(25, 125, 25, 0.7)", "rgba(179, 9, 0, 0.7)", "rgba(21, 101, 192, 0.7)"]
#           height_proportion: 1
#           indicadores: ["te_rgt","te_nat","te_res"]
#           lat: 'latitude'
#           long: 'longitude'
#           tooltip_function: 'obsTETooltip'
#         source:
#           desc: "Bancos de dados do Seguro-Desemprego do Trabalhador Resgatado, do Sistema de Acompanhamento do Trabalho Escravo (SISACTE) e do Sistema COETE (Controle de Erradicação do Trabalho Escravo), referentes ao período iniciado em 2003 (Primeiro Plano Nacional de Erradicação do Trabalho Escravo). Os dados brutos foram fornecidos pelo Ministério da Economia do Brasil."
#           link: ""
#         description:
#           - type: "text"
#             title: ""
#             content:
#               fixed: "O mapa ao lado apresenta agrupamentos de municípios (clusters) conforme a distribuição espacial de localidades de resgates, naturalidade e residência declarada de egressos, conforme a seleção abaixo."
#           - id: "selectlayer"
#             type: "radio"
#             items:
#               - id: "te_rgt"
#                 cls: "xs12"
#                 label: "Resgates"
#                 value: "te_rgt"
#                 color: "green accent-4"
#               - id: "te_nat"
#                 cls: "xs12"
#                 label: "Naturalidade Apurada"
#                 color: "red"
#                 value: "te_nat"
#               - id: "te_res"
#                 cls: "xs12"
#                 label: "Residência Apurada"
#                 color: "light-blue"
#                 value: "te_res"
#             event: 'selection'
# ===============================================
#       - id: "prevalencia_priori_headline"
#         type: "headline"
#         title:
#           fixed: "Áreas Prioritárias"
# # ===============================================
#       - id: "bar_priori_mun_casos"
#         title: 
#           fixed: "Municípios - Maior número de casos na UF"
#         title_comment:
#           template: "{0}, {1}"
#           api: 
#             template: "/thematic/casoscovid19?categorias=1&valor=last_available_date&agregacao=MAX&filtros=eq-place_type-'city',and,eq-is_last-TRUE,and,eq-cd_uf-{0}"
#             args:
#               - named_prop: 'idLocalidade'
#           args:
#             - base_object: "localidade"
#               named_prop: "nm_localidade"
#             - named_prop: "agr_max_last_available_date"
#               format: 'dataDMY'
#         # info:
#         #   - type: "text"
#         #     title: "Sobre a métrica"
#         #     content:
#         #       fixed: ""
#         description:
#           - type: "text"
#             title: ""
#             content:
#               fixed: "Destacam-se, neste estudo, os municípios com o maior número de casos confirmados.<br/><br/>"
#         chart_type: "BAR"
#         api:
#           template: "/thematic/casoscovid19?categorias=nm_municipio_uf,city_ibge_code,city,state,last_available_confirmed,last_available_deaths&valor=last_available_confirmed&agregacao=RANK_DENSE_SUM&filtros=eq-place_type-'city',and,eq-is_last-TRUE,and,eq-cd_uf-{0}&limit=5"
#           args:
#             - named_prop: 'idLocalidade'
#           options:
#             formatters:
#               - id: "last_available_confirmed"
#                 format: 'inteiro'
#               - id: "last_available_deaths"
#                 format: 'inteiro'
#         headers:
#           - text: 'Município'
#             align: 'left'
#             value: 'nm_municipio_uf'
#           - text: 'Casos confirmados'
#             value: 'fmt_last_available_confirmed'
#           - text: 'Óbitos confirmados'
#             value: 'fmt_last_available_deaths'
#         chart_options:
#           id: "city_ibge_code"
#           x: "agr_rank_dense_sum_last_available_confirmed"
#           y: "last_available_confirmed"
#           text: "nm_municipio_uf"
#           hide_legend: true
#           orientation: "vertical"
#           show_x_axis: false
#           show_y_axis: false
#           color: "#238B45"
#         source:
#           desc: ""
#           link: ""
# # ===============================================
#       - id: "bar_priori_mun_obitos"
#         title: 
#           fixed: "Municípios - Maior número de óbitos na UF"
#         title_comment:
#           template: "{0}, {1}"
#           api: 
#             template: "/thematic/casoscovid19?categorias=1&valor=last_available_date&agregacao=MAX&filtros=eq-place_type-'city',and,eq-is_last-TRUE,and,eq-cd_uf-{0}"
#             args:
#               - named_prop: 'idLocalidade'
#           args:
#             - base_object: "localidade"
#               named_prop: "nm_localidade"
#             - named_prop: "agr_max_last_available_date"
#               format: 'dataDMY'
#         # info:
#         #   - type: "text"
#         #     title: "Sobre a métrica"
#         #     content:
#         #       fixed: ""
#         description:
#           - type: "text"
#             title: ""
#             content:
#               fixed: "Destacam-se, neste estudo, os municípios com o maior número de óbitos confirmados.<br/><br/>"
#         chart_type: "BAR"
#         api:
#           template: "/thematic/casoscovid19?categorias=nm_municipio_uf,city_ibge_code,city,state,last_available_deaths,last_available_confirmed&valor=last_available_deaths&agregacao=RANK_DENSE_SUM&filtros=eq-place_type-'city',and,eq-is_last-TRUE,and,eq-cd_uf-{0}&limit=5"
#           args:
#             - named_prop: 'idLocalidade'
#           options:
#             formatters:
#               - id: "last_available_deaths"
#                 format: 'inteiro'
#               - id: "last_available_confirmed"
#                 format: 'inteiro'
#         headers:
#           - text: 'Município'
#             align: 'left'
#             value: 'nm_municipio_uf'
#           - text: 'Óbitos confirmados'
#             value: 'fmt_last_available_deaths'
#           - text: 'Casos confirmados'
#             value: 'fmt_last_available_confirmed'
#         chart_options:
#           id: "city_ibge_code"
#           x: "agr_rank_dense_sum_last_available_deaths"
#           y: "last_available_deaths"
#           text: "nm_municipio_uf"
#           hide_legend: true
#           orientation: "vertical"
#           show_x_axis: false
#           show_y_axis: false
#           color: "#DA3736"
#         source:
#           desc: ""
#           link: ""
